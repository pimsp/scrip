\documentclass{article}

\usepackage{graphicx}
%\pagestyle{empty}
\usepackage{dsfont}
\usepackage{textcomp}
\usepackage{amsmath}
\usepackage{courier}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\graphicspath{{images/}}
\usepackage{amsthm}
\usepackage{eucal}
\usepackage{amssymb}
%\usepackage{mdsymbol}
\usepackage{mathrsfs}
\usepackage{dsfont}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{caption}
\usepackage{tikz}
\usepackage{tikz-cd}
\usepackage{wrapfig,lipsum,booktabs}
\usepackage{caption}
\usepackage[square, longnamesfirst,numbers]{natbib}
\usepackage[ruled,linesnumbered]{algorithm2e}

%\usepackage{hyperref}
\usepackage{amstext} % for \text macro
\usepackage{array}   % for \newcolumntype macro
\usepackage[unicode]{hyperref}
\usepackage{verbatim}
\usepackage{makecell}
\usepackage{float}
\usepackage{mathtools}

\newcolumntype{C}{>{$}c<{$}} % math-mode version of "l" column type

\relpenalty=10000
\binoppenalty=10000

\newcommand{\den}{\mathop{\mathgroup\symoperators den}\nolimits}
\newcommand{\ggd}{\mathop{\mathgroup\symoperators ggd}\nolimits}
\newcommand{\des}{\text{d.e.s.d.a.\ }}
%\newcommand{\opg}{\text{d.e.s.d.a.\ }}
\newcommand{\blokje}{\hfill $\Box$\\}
%Om je bewijs of je antwoord af te sluiten.
\newcommand{\header}[1]{\vspace{0.5cm}\framebox[\linewidth]{\textsc{Exercise #1}}\\}
\newcommand{\deel}[1]{\textbf{#1)}\ }
\newcommand{\macht}[1]{\mathcal{P}(#1)}
\newcommand{\entier}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\renewcommand{\G}{\mathbb{G}}
\renewcommand{\C}{\mathbb{C}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\Lcal}{\mathcal{L}}
\renewcommand{\O}{\mathcal{O}}
\renewcommand{\P}{\mathbb{P}}
\newcommand{\Pcal}{\mathcal{P}}
\newcommand{\NP}{\mathcal{NP}}
\newcommand{\NPC}{\mathcal{NPC}}
\newcommand{\F}{\mathbb{F}}
\renewcommand{\angle}[1]{\hspace{-2pt}\left\langle #1 \right\rangle}
\newcommand*\diff{\mathop{}\!\mathrm{d}}
\newcommand{\rad}{\text{rad}}
\newcommand{\x}{x}
\newcommand{\m}{\mathfrak{m}}
\newcommand{\tensor}{\otimes}
\newcommand{\Ring}{\textbf{Rings}}
\newcommand{\Sets}{\textbf{Sets}}

\DeclareMathOperator{\mon}{mon}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\End}{End}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\trdeg}{trdeg}
\DeclareMathOperator{\rk}{rk}
\DeclareMathOperator{\Fun}{Fun}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\Spf}{Spf}
\DeclareMathOperator{\sep}{sep}
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\GL}{GL}
\let\S\undefined
\DeclareMathOperator{\S}{S}
\DeclareMathOperator{\A}{A}
\let\div\undefined
\DeclareMathOperator{\div}{div}

\frenchspacing

\begingroup
\makeatletter
\@for\theoremstyle:=definition,remark,plain\do{%
	\expandafter\g@addto@macro\csname th@\theoremstyle\endcsname{%
		\addtolength{\thm@preskip}{5pt}
		\setlength{\thm@postskip}{10pt}
	}%
}
\endgroup %Zorgt voor mooie enters voor claims


\title{A geometric approach to linear and quadratic Chabauty}
\author{Pim Spelier}
\date{November 2015}

%\newtheoremstyle{mytheoremstyle}{5pt}{-15pt}{\itshape}{}{\bfseries}{.}{.5em}{} 

\theoremstyle{plain}
\newtheorem{thm}{Theorem}[section] % reset theorem numbering for each section
\newtheorem{lem}[thm]{Lemma} % same for lemma's
\newtheorem{conj}[thm]{Conjecture} % same for vermoedens
\newtheorem{cor}[thm]{Corollary} % same for vermoedens
\newtheorem{prop}[thm]{Proposition} % same for vermoedens
\newtheorem{algo}[thm]{Algorithm} % same for vermoedens

\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition} % definition numbers are dependent on theorem numbers
\newtheorem{exmp}[thm]{Example} % same for example numbers

\theoremstyle{remark}
\newtheorem{rem}[thm]{Remark} % remark numbers are dependent on theorem numbers

\usepackage{chngcntr}
\counterwithin{table}{section}

\newcommand{\overbar}[1]{\overline{#1}}

%\setlength{\parindent}{0pt}
%\setlength{\parskip}{\baselineskip}

\newcommand\legendre[2]{
  \genfrac(){}{}{#1}{#2}
}

\newcommand{\ord}{\operatorname{ord}}

\begin{document}
%\nocite{*}

\vspace*{1em}

\begin{center}

{\Large\bf 
P.\ Spelier
} 

\vspace{1em} 

{\LARGE\bf 
A geometric approach to linear and quadratic Chabauty
} 

\vspace{10em} 

{\large\bf 
Master thesis
} 

\vspace{1em}

{\large\bf 
\today
}

\vspace{10em} 

{\large\bf
\begin{tabular}{ll}
Thesis supervisor: & prof. dr. S.J. Edixhoven\\
\end{tabular}
}

\vfill

\includegraphics{ulzegel_blauw}\\

\vspace{2em}

{\large\bf 
Leiden University\\
Mathematical Institute\\
}

\end{center}
\thispagestyle{empty}
\newpage

\tableofcontents
\newpage

%-----------------------------------------------------------------------------------------------------------------------

\section{Introduction}
\label{section:intro}
Say something about the problem, Faltings, et cetera

Say something about Chabauty's general idea

Mention Flynn, Coleman, Kim, Balakrishnan, Dogra, and other mentionable people. and their way of doing (quadratic) Chabauty

Say something about linear Chabauty geometric style.

Say something about quadratic Chabauty geometric style.

Say how much is borrowed from the article by Bas and Guido, but with a focus on the linear part, and more explanations.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Linear Chabauty}
Let $p>2$ be a prime, and $C$ be a scheme over $\Z$, proper, flat, regular with $C$ smooth over $\Z_{(p)}$ and $C_\Q$ of dimension $1$ and geometrically connected, of genus $g \geq 1$ and with the Jacobian $J$ of $C_\Q$ having Mordell-Weil rank $r < g$. Assume we have a $\Q$-point $b$ in $C$, or equivalently a $\Z$-point. We view $C_\Q$ as a subscheme of $J$, using the map $Q \mapsto Q - b$ on points. Let $P \in C(\F_p)$ be a point such that $t := P - b \in J(\F_p)$ lies in the image of $J(\Z)$.

\begin{defn}
Let $S$ be a scheme, $T \to U$ a morphism of schemes and $x : T \to S$ a $T$-point. We define $S(U)_x$ as the morphisms from $U$ to $S$ that, after precomposing with $T \to U$, give $x$.
\end{defn}

We want to find an upper bound for the cardinality of $C(\Z)_P$

% Say something about smooth schemes over Z_p, and their Z_p points
\subsection{Points on a smooth scheme over \texorpdfstring{$\Z_p$}{Z\_p}}
\label{subs:smoothzppoints}
Let $X/\Z_p$ be a smooth scheme of relative dimension $d$, and let $x \in X(\F_p)$ be a point. Then $X(\Z_p)_x$ is in bijection with $\Z_p^d$. This bijection is given by choosing parameters at $x$; evaluating at $X(\Z_p)_x$ gives a bijection with $(p\Z_p)^d$, and then we divide by $p$. For putting up a nice framework to work in, we start with blowing up $X$ at $x$.
%TODO: give proof and define $\Z_p\angle{z_1,...,z_r}$ as the $p$-adic completion of $\Z_p[z_1,...,z_r]$, i.e. powerseries which are polynomials modulo every power of $p$.

% Blow up X at x, and look at the part where p generates the maximal ideal
Assume, by looking at a neighborhood of $x$, that $X = \Spec A$ is affine and that $p,t_1,\dots,t_d$ generate the maximal ideal of $O_{X,x}$ with $t_1,\dots,t_d$ elements of $O_X(X) = A$, also called \textit{parameters} at $x$. By shrinking $X$ even more, we may assume as $X$ is smooth that $t = (t_1,\dots,t_d): X \to \A^d_{\Z_p}$ is \'etale. Now consider the blowup $\Tilde{X}_x \to X$ of $X$ at $x$, and let $\Tilde{X}_x^p$ be the part where $p$ generates the inverse image of the maximal ideal of $O_{X,x}$. Equivalently, that is the part where $t_1,\dots,t_d$ are multiples of $p$, so informally it consists of the points that reduce to $x$ modulo $p$.

There is an explicit description of the map $\Tilde{X}_x^p \to X$; as $t$ is \'etale, the ideal of $X$ defining $x$ is the pullback along $t$ of the ideal of $\A^d_{\Z_p}$ defining the origin $a$ over $\F_p$. That means that the blowup $\Tilde{X}_x \to X$ is the pullback of the blowup $\Tilde{\A}^d_{\Z_p,a} \to \A_{\Z_p}^d$. Then the part $\Tilde{X}_x^p$ is the pullback of the corresponding part of $\Tilde{\A}^d_{\Z_p,a}$, i.e. $\Spec \Z_p[\Tilde{x_1},\dots,\Tilde{x_d}] = \Spec \Z_p[x_1/p,\dots,x_d/p]$ with the morphism $\Z_p[x_1,\dots,x_d] \to \Z_p[\Tilde{x_1},\dots,\tilde{x_d}]$ given by $x_i \mapsto p\Tilde{x_i}$. That implies that $\Tilde{X}_x^p$ is $\Spec A[t_1/p,\dots,t_d/p]$, with the map $\Tilde{X}_x^p \to X$ given by the inclusion $A \to \Spec A[t_1/p,\dots,t_d/p]$ (remember that the $t_i$ are elements of $O_X(X) = A$).

This now enables us to characterise explicitly the $\Z_p$-points above $x$, as in the following two lemmas.

\begin{lem}
With $X$ as above, there is a natural bijection $X(\Z_p)_x \to \Tilde{X}_x^p(\Z_p)$,
\end{lem}
\begin{proof}
Note that by (I,2.4.4) of \cite{ega}, a $\Z_p$ point of a scheme $S$ is just an $\F_p$-point $s$ together with a local morphism $\O_{S,s} \to \Z_p$. In our case, we find that $X(\Z_p)_x$ is naturally in bijection with $\Hom_{\text{local}}(A_x,\Z_p)$. As the maximal ideal of $A_x$ is generated by $p,t_1,\dots,t_d$, the locality property just means that the images of $t_1,\dots,t_d$ are divisible by $p$, i.e. exactly those morphisms that extend to a morphism $A[t_1/p,\dots,t_d/p] \to \Z_p$, i.e. a $\Z_p$-point of $\Tilde{X}_x^p$. Hence we find the natural bijection.
\end{proof}

\begin{lem}
With $X$ as above, evaluating $t$ at $X(\Z_p)_x$ gives a bijection to $(p\Z_p)^d$.
\end{lem}
\begin{proof}
As $t$ is locally of finite type, by (IV,17.6.3) of \cite{ega} we have an isomorphism between the $p$-adic completion $O(\Tilde{X}_x^p)^{\wedge p}$ and the completion $\Z_p\angle{\Tilde{x_1},\dots, \Tilde{x_d}}$ of $\Z_p[\Tilde{x_1},...,\Tilde{x_d}]$, with the latter completion being the ring of convergent power series, i.e.
\[
\Z_p\angle{\Tilde{x_1},\dots, \Tilde{x_d}} = \left\{f \in \Z_p[[\Tilde{x_1},\dots,\Tilde{x_d}]] \mid \forall n \geq 0, f + (p^n) \in \Z/p^n\Z[\Tilde{x_1},\dots,\tilde{x_d}] + (p^n) \right\}.
\]
By the universal property of completions, as $t$ induces the isomorphism between completion, $t$ also induces a bijection $$\Hom(O(X(\Z_p)_x), \Z_p) \to \Hom(O(X(\Z_p)_x)^{\wedge p}, \Z_p) = \Hom(\Z_p\angle{\Tilde{x_1},\dots,\Tilde{x_d}},\Z_p) = \Z_p^d.$$ Following all the bijections, we indeed get the bijection we wanted.
\end{proof}

Note that this construction is functorial, as in the following lemma:
\begin{lem}
\ref{lem:smoothpointfunc}
Given two smooth schemes $X,Y$ over $\Z_p$ and two $\F_p$-points $x\in X(\F_p), y\in Y(\F_p)$, a map $f: Y \to X$ satisfying $f(y) = x$ gives rise to a morphism $\Tilde{Y}_y^p \to \Tilde{X}_x^p$.
\end{lem}
\begin{proof}
TODO: give proof.
\end{proof}

[TODO: add that the map $\Tilde{Y}_y^p(\Z_p) \to \Tilde{X}_x^p(\Z_p)$ is, after choosing parameters, given by convergent power series; are these in general linear modulo $p$? And what happens modulo higher powers?]

Finally, we look at the specific case of $X$ being of relative dimension $1$ over $\Z_p$. It then turns out that there is additionally a free transitive $\F_p$-action on $X(\Z/p^2\Z)_0$. [TODO: maybe replace this by an action of the tangent space of $X_{\F_p}$ at $x$]. We can parametrise $X(\Z/p^2\Z)_0$ by $t = t_1 : X(\Z/p^2\Z)_0 \to p\Z/p^2\Z$; write $P_{\lambda}$ for the point with $t$-value $\lambda p$. Then as Cartier divisor, the point $P_{\lambda}$ is defined by $t - \lambda p \in O(X_{\Z/p^2\Z})_x$, so $P_{\lambda} + P_{\mu}$ is defined by $(t-\lambda p)(t-\mu p) = t^2 - (\lambda + \mu)tp$, which defines the same Cartier divisor as $P_{\lambda'} + P_{\mu'}$ if and only if $\lambda + \mu = \lambda' + \mu'$. So as a Cartier divisor, $P_{\lambda} + P_{\mu}$ is in fact equal to $P_{\lambda'} + P_{\mu'}$.

\subsection{From \texorpdfstring{$J(\Z)$}{J(Z)} to \texorpdfstring{$J(\Z_p)$}{J(Z\_p)}}
For $p > 2$, we know that the torsion of $J(\Z)$ injects into $J(\F_p)$, by Proposition 2.3 of \cite{pierre2000}. Hence for $0 \in J(\F_p)$, we know $J(\Z)_0$ is as a group isomorphic to $\Z^r$ with $r$ the Mordell-Weil rank. By assumption, we also know $J(\Z)_t$ is in bijection with $J(\Z)_0$, with the bijection giving by translating with a lift of $t$. By Subsection \ref{subs:smoothzppoints} we know $J(\Z_p)_t$ is in bijection with $\Z_p^{g}$, with the bijection given by evaluating parameters and dividing by $p$. Let $\kappa: \Z^r \to \Z_p^g$ be the map resulting from the inclusion $J(\Z)_t \to J(\Z_p)_t$. Then $\kappa$ turns out to have a special property.

\begin{thm}
\label{thm:kappanice}
There are uniquely determined $\kappa_1,\dots,\kappa_g \in \Z_p\angle{z_1,...,z_r}$ such that for all $x \in \Z^r$ we have $\kappa(x) = (\kappa_1(x),\dots,\kappa_g(x))$ and the image $\overline{\kappa_i}$ of $\kappa_i$ in $\F_p[z_1,...,z_r]$ has degree at most $1$.
\end{thm}

We will prove this using results about formal group as defined in \citep{honda70}. To be able to use this theory, we first give some results about going from a group scheme over $\Z_p$ to a formal group.
First we introduce some notation that will be used in this section. Let $R$ be a commutative ring, and $x = (x_1,\dots,x_n)$ and sometimes $y,z$ are vectors of variables. Then $R[[x]]$ denotes as usual the powerseries in the $x_i$, and $R[[x]]_0$ denotes those power series with constant term $0$. With $x = (x_1,\dots,x_n)$ and $y = (y,_1,\dots,y_m$), let $f \in R[[x]]^m$ and assume $f(0) = 0$. Then for $g \in R[[y]]^k$ for some $k\in\Z_{\geq 0}$, we can compose $g$ and $f$ to get $g\circ f := (g_1(f(x)),\dots,g_k(f(x)))\in R[[x]]]^k$. This definition makes sense because $f^i$ converges to $0$, so for any $a \in R^{\Z_{\geq 0}} $ the sum $\sum_i a_i f^i$ always converges. 

\subsubsection{From group schemes to formal groups}
We first recall the definition of a formal group. For this entire section, $R$ is a ring, and $x,y,z$ are vectors of variables.
\begin{defn}
\label{defn:formalgroup}
Let $n$ be a non-negative integer. Let $x,y,z$ be vectors of $n$ variables. An $n$-dimensional formal group is an element $F = (F_1,\dots,F_n) \in R[[x,y]]_0^n$ satisfying $F \equiv x + y \mod (x,y)^2$ and $F(F(x,y),z) = F(x,F(y,z))$. If furthermore $F(x,y) = F(y,x)$, this formal group is said to be commutative.
\end{defn}
\begin{exmp}
\label{exmp:gmformalgroup}
Take $n=1$ and $F(x,y) = x + y + xy = (1+x)(1+y)-1$, also known as the multiplicative formal group. This satisfies associativity as $F(F(x,y),z) = (1+x)(1+y)(1+z)-1 = F(x,F(y,z))$.
\end{exmp}
\begin{exmp}
\label{exmp:ganformalgroup}
For any $n$, we can take $F(x,y) = x+ y$, also known as the $n$-dimensional additive formal group.
\end{exmp}
[TODO: add text explaining the following lemma]
Note there is no mention of an inverse, but the following lemma, a formal version of the implicit function theorem, tells us that the inverse follows automatically from the definitions.
\begin{lem}
\label{lem:implicitfunction}
Let $x,y$ have length $n$. Let $F \in R[[x,y]]_0^n$ such that $F \equiv Ax + By \bmod (x,y)^2$ with $B \in \GL_n(R)$. Then there's a unique $\iota \in R[[x]]_0^n$ such that $F(x,\iota(x)) = 0$. 
\end{lem}
\begin{proof}
If $F$ is a polynomial, this is a special case of a multivariate version of Hensel's lemma, as in Corrolaire~2 of \cite[III,4.5]{BourbakiCA}, over $R[[x]]$ with maximal ideal $\m = (x)$, as the derivative matrix of $F(x,\iota)$ with respect to $\iota$ is $B$, which is invertible, and $\iota = 0$ gives a solution modulo $\m$. Now for $F$ any power series, let $F_j$ be the polynomial consisting of all terms in $F$ of degree at most $j$, and let $\iota_j$ be the unique power series in $R[[x]]_0^n$such that $F_j(x,\iota_j) = 0$. Note that both $\iota_j$ and $\iota_{j+1}$ are solutions to $F_j(x,\iota) \equiv 0 \mod \m^j$, so by the uniquess guaranteed by Hensel's lemma used over $R[[x]]/\m^j$, these must be equal. Hence they converge to $\iota \in R[[x]]_0^n$, which is the unique solution of $F(x,\iota(x)) = 0$.
\end{proof}
This has the following corollary about the inverse of a power series.
\begin{cor}
\label{lem:formalinverse}
Let $x$ have length $n$. Let $a \in R[[x]]_0^n$ with $a \equiv Px \mod x$ for some matrix $A\in \GL_n(R)$. Then there is a unique $b \in R[[x]]_0^n$ such that $a \circ b = b \circ a = x$.
\end{cor}
\begin{proof}
Let $F(x,y) = x - a(x)$. This satisfies the constraints of Lemma~\ref{lem:implicitfunction}, so we find a unique $b$ such that $a \circ b = x$. Applying Lemma~\ref{lem:implicitfunction} again gives a unique $c$ such that $b \circ c = x$. But then $a = a \circ (b \circ c) = (a \circ b) \circ c = c$ shows $a = c$ and hence we are done.
\end{proof}
So a formal group $F$ does by Lemma~\ref{lem:implicitfunction} indeed have a right inverse $\iota_F$. Also, by $F(0,0) = 0$ we have that $F(x,F(\iota_f,0)) = 0$ so $F(\iota_f,0)$ is in fact equal to $\iota_F$; as $\iota_F \equiv -x \mod (x)^2$, it has a formal inverse and hence $F(x,0) = x$, so $0$ is indeed a right unit. A standard argument now shows that $\iota_F$ is also a left inverse and $0$ is also a right unit, so $F$ gives $R[[x]]$ the structure of a group object in the category of topological rings; for two continuous morphisms $f_1,f_2$ from $R[[x]]$ to some ring $A$, given by sending $x$ to $a_1,a_2$ respectively, we define $(f_1 \oplus f_2)(x) = F(a_1,a_2)$, and by our considerations this makes $\Hom_{\text{cont}}{R,A}$ into a group, functorially in $A$.

Given a smooth scheme $G$ over $\Z_p$ of relative dimension $d$, together with a $\Z_p$-point $e$, we can look at the completion $\Hat{O}_{G,e}$ along the section $e$. By smoothness, after picking parameters, this is isomorphic as topological $\Z_p$-algebras to the ring of power series $\Z_p[[x_1,\dots,x_d]]$. This completion naturally gives rise to a formal scheme denoted $\Spf \Hat{O}_{G,e}$; in a categorical notion, this is a functor on finite length $\Z_p$-algebras sending $A$ to $\Hom_{\text{cont}}(\Hat{O}_{G,e},A)$, but we can also think of it as a locally ringed space with $\Spec \Z_p$ as topological space, and sheaf of rings $\Hat{O}_{G,e}$. 

If furthermore $G$ is a group scheme over $\Z_p$, then this formal scheme promotes to a formal group scheme, i.e. for every finite $\Z_p$-algebra $A$ the set $\Hom_{\text{cont}}(\Hat{O}_{G,e},A)$ gets a group structure, functorially in $A$. By functoriality, this is the same [TODO: why exactly?] as an continuous coproduct $\mu: \Hat{O}_{G,e} \to \left(\Hat{O}_{G,e}\right)^{\Hat{\tensor} 2}$. After choosing an isomorphism between $\Hat{O}_{G,e}$ and $\Z_p[[x_1,\dots,x_d]]$, let $F_j \in \Z_p[[x,y]]$ denote $\mu(x_i)$. Then it is clear that $F_G = (F_1,\dots,F_d)$ is a $d$-dimensional formal group scheme, and commutative if $G$ was commutative.
\begin{exmp}
\label{exmp:gmtoformal} %TODO: nicely LaTeX Example bla, continued
Take $G = \G_m$ over $\Z_p$, i.e. $\Z_p[u,u^{-1}]$. Then the zero section $e$ is the map sending $u$ to $1$, and we can identify the completion $\Hat{O}_{G,e}$ with the power series ring $\Z_p[[u-1]] \cong \Z_p[[x]]$, sending $u-1$ to $x$. The group structure on $G$ then gives rise to the coproduct $\Z_p[[u-1]] \to \Z_p[[u-1,v-1]], u \mapsto uv$ so the coproduct on $\Z_p[[x]]$ sends $x$ to $uv-1 = (x+1)(y+1) -1 = x + y + xy$. Hence the formal group $F_{\G_m}$ corresponding to this group scheme is exactly the multiplicative formal group from Example~\ref{exmp:gmformalgroup}.
\end{exmp}

This formal group tells us exactly how multiplication works on $G(\Z/p^e\Z)_0$; if we let $t = (t_1,\dots,t_d)$ denote the formal parameters giving the isomorphism $\Hat{O}_{G,e} \to \Z_p[[x_1,\dots,x_d]]$, and we represent a point $P$ in $G(\Z/p^e\Z)_0$ by their parameter values $t(P) \in p\Z/p^e\Z$, then the multiplication $p\Z/p^e\Z \times p\Z/p^e\Z \to p\Z/p^e\Z$ is exactly $F$. By taking limits, $F$ also gives the multiplication on $G(\Z_p)_0$.

Now we will look at the theory of formal groups, and how that will help us. For a $n$-dimensional formal group $F$ over a ring $R$, Proposition~1.1 of \citep{honda70} gives us a canonical $R$-basis $\omega_1,\dots,\omega_n$ of the right invariant differentials; these are elements of $\bigoplus_{j=1}^n R[[x]] \diff x_j$. If the formal group is furthermore commutative, then by Proposition~1.3 of \citep{honda70} these are closed, i.e. $d\omega_j = 0$. A $1$-form $d\omega = \sum_{i=1}^n f_i \diff x_i$ being closed means exactly that $\frac{\partial f_i}{\partial x_j} = \frac{\partial f_j}{\partial x_i}$ for all $i,j$, and then, if $R$ has no torsion, we can formally integrate $\omega$, i.e. write it as $df$ where $f \in (\Q\tensor R)[[x]]$. We make this unique by demanding that $f(0) = 0$. Writing this $f$ as $\sum_{I \in \N^n} a_I x^I$ with $I$ denoting a multi index and $a_I \in \Q\tensor R$, we see that $a_I$, although itself not necessarily lying in $R$, is close: writing $I = (I_1,\dots,I_n)$ we see that for all $j$ we must have $I_j a_I \in R$ as $f_j = \frac{\partial f}{\partial x_j} \in R[[x]]$.

In particular, we write $\log_i$ for the unique element of $(\Q\tensor R)[[x]]$ such that $d\log_i = \omega_i$. Together, these $\log_i$ give an element $\log \in R[[x]]^n$, and by Theorem~1 of \citep{honda70}, this logarithm satisfies $\log(x) = x \mod (x)^2$, and $\log(F(x,y)) = \log(x)+\log(y)$. By the first result, $\log$ has an inverse which we will call $\exp$, also given by powerseries in $(\Q\tensor R)[[x]])$, and also satisfying $\exp(x) = x \mod (x)^2$.
\begin{exmp} %TODO: nicely LaTeX Example bla, continued
Taking $F$ the multiplicative group as in Example~\ref{exmp:gmformalgroup}, Proposition~1.1 of \citep{honda70} gives us $\omega = \frac{1}{x+1}dx$; as a power series this is $\sum_{j \geq 0} (-x)^j$. The formal anti-derivative of this is $\log = \sum_{j \geq 1} \frac{-(-x)^j}{j}$, and Theorem $1$ will tell us what we already know in the context of analysis $\log(x + y + xy) = \log(x)+\log(y)$. Then analysis will also explicitly tell us what $\exp$ looks like: namely, $\exp(x) = \sum_{j \geq 1} \frac{x^j}{j!}$.
\end{exmp}

Now we will see how we can use this formal logarithm in our case of the formal group $F_G$ stemming from a $d$-dimensional smooth group scheme $G/\Z_p$. Recall that we have a bijection $G(\Z_p)_0 \to p\Z_p^d \to \Z_p^d$ given by evaluating at parameters $t = (t_1,\dots,t_d)$ and then dividing by $p$; furthermore, recall that the group structure on $G(\Z_p)_0$ is the same as the group structure defined by $F_G$ on $p\Z_p^d$. Let $\log \in \Z_p[[x]]^d$ denote the logarithm corresponding to $F_G$, and let $\log_p$ denote the power series $\log(px)/p = (\log_1(px)/p,\dots,\log_d(px)/p)$. We then have the following little lemma to bridge the gap between power series and maps.
\begin{lem}
\label{lem:formallog}
With notation as above, we have the following statements about $\log_p$:
\begin{enumerate}
	\item $\log_p$ lies in $\Z_p\angle{x_1,\dots,x_d}^d$, the ring of convergent power series, and hence defines a map $\log_p: \Z_p^d \to \Z_p^d$.
	\item Letting $\oplus$ denote the group structure on $\Z_p^d$ coming from the bijection $G(\Z_p)_0 \to p\Z_p^d \to \Z_p^d$, the map $\log_p$ is a group morphism from $(\Z_p^d,\oplus)$ to $(\Z_p^d,+)$.
	\item If $p > 2$, the map $\log_{p,i}$ reduces to $x_i$ modulo $p$ and hence $\log_p$ has an inverse $\exp_p$, which is also an element of $\Z_p\angle{x_1,\dots,x_d}$. Then this $\exp_p$ is a two-sided inverse of $\log_p$, and hence $\log_p: \Z_p^d \to \Z_p^d$ is a bijection.
\end{enumerate} 
\end{lem}
\begin{proof}
Write $\log_{i} = \sum_{I} a_{i,I} x^I$ and $log_{p,i} = \sum_I a_{i,I} p^{|I|-1} x^I$ where $I$ ranges over the multi indices. Recall that $a_{i,0} = 0$. Also, recall that although a priori the coefficients $a_I$ lie in $\Q_p$, we have $I_j a_{i,I} \in \Z_p$ for all $I$ and $i,j$. For purposes of easy estimation, this also means $|I|a_{i,I} \in \Z_p$. As we have, with no constraint on $p$, for all $n\geq $ that $c_n\coloneqq p^{n-1}/n$ lies in $\Z_p$ and converges to $0$, this means that \[ \log_{p,i} = \sum_I a_{i,I} p^{|I|-1} x^I = \sum_I |I|a_{i,I} c_{|I|} x^I\] is indeed an element of $\Z_p\angle{x_1,\dots,x_d}^n$, and hence defines a map $\Z_p^d \to \Z_p$. Hence all the $\log_{p,i}$ together give a map $\Z_p^d \to \Z_p^d$. By the equality of power series $\log(F(x,y)) = \log(x)+\log(y)$ from the definition of the logarithm, and the fact that all these powerseries converge on $p\Z_p^d$, this $\log_{p,i}$ is indeed a group morphism from $(\Z_p^d,\oplus)$ to $(\Z_p^d,+)$

To study $\log_p$ modulo $p$, we note that if $n\geq 3$, then $p$ actually divides $c_n$, and for $p > 2$ we even have $p|c_2$. As $\log_{p,i} = x_i \mod (x)^2$, this means that for $p > 2$ we have \[\log_{p,i} \equiv \sum_{|I| = 1} |I|a_{i,I}c_|I| x^I \equiv x_i \bmod p.\]
Note that as $\log_p \equiv x \mod (x)^2$, by Lemma~\ref{lem:formalinverse} it has an inverse $\exp_p \in \Z_p[[x]]_0^n$. Modulo $p$, this $\exp_p$ must be $x$, which lies in $\Z_p\angle{x}_0^n$; as $\Z_p\angle{x}$ is $p$-adically complete, using Hensel this shows $\exp_p$ is indeed in $\Z_p\angle{x}_0^n$.
\end{proof}
[TODO: I'd like to study what happens modulo higher powers of $p$; for example, if $\log_p$ is at most quadratic mod $p^2$, then so is $\exp_p$; and similar for $\log_p$ at most cubic mod $p^3$. Even in general, if $\log_p$ has degree at most $d$ modulo $p^k$, then $\exp_p$ has degree at most $f = f(d,k)$ (seen most easily by working in a ``universal'' ring $\Z[p]/(p^k)$).

This lemma makes the proof of Theorem~\ref{thm:kappanice} relatively easy. 
\begin{proof}[Proof of Theorem~\ref{thm:kappanice}]
Write $\log_p$ for the logarithm corresponding to the formal group corresponding to the The map $\kappa: \Z^d \to \Z_p^g$ given by the inclusion $J(\Z)_0$ to $J(\Z_p)_0$ is a group morphism with the group structure on $\Z^d$ being addition and the group structure on $\Z_p^g$, denoted by $\oplus$, given by the bijection with $J(\Z_p)_0$ induced by choosing parameters at $0$. Then by Lemma~\ref{lem:formallog} the map factors as in the diagram of groups
\[
% https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZABgBpiBdUkANwEMAbAVxiRAAoAdTgLQD0opANQBKEAF9S6TLnyEUAJnJVajFmy68A+mj4BzUtwhpmcMZOnY8BIgEZStlfWatEHbjx37h5lTCh68ESgAGYAThAAtkhkIDgQSPYgDHQARjAMAAoy1vLJMCE4INTO6m7cANZ0aGh0ElIg4VEx1PFISqoubNwMEHo6AATcAMZYYcNDnFU1dRaNEdGIHW2ISaWuINwwAB5oOhIU4kA
\begin{tikzcd}
{(\Z^d,+)} \arrow[rr, "\kappa"] \arrow[rd, "\log_p \circ \kappa"] &                                   & {(\Z_p^g,\oplus)} \\
                                                                  & {(\Z_p^g,+)} \arrow[ru, "\exp_p"] &                  
\end{tikzcd}
\]
Then the arrow $\log_p \circ \kappa$ is just a linear map, and $\exp_p$ is a convergent power series that is linear modulo $p$, so their composite $\kappa$ is also a convergent power series linear modulo $p$.
\end{proof}

This immediately gives rise to the following corollary.
\begin{cor}
\label{cor:closurejac}
The map $\kappa$ extends uniquely to a continuous map $\kappa: \Z_p^r \to \Z_p^g$, given by the same power series, and the closure $\overline{J(\Z)_t} \subset J(\Z_p)_t$ is given by the image of $\Z_p^r$ under $\kappa$.
\end{cor}

[TODO: in general, generators of the Mordell-Weil group are computationally out of reach. But, if we only generate a subgroup of $J(\Z)_0$ of index finite and coprime to $p$, then the closure of this in $J(\Z_p)_0$ will be the same. This happens in particular if we generate a subgroup of $J(\Z)$ of index finite and coprime to $p|J(\F_p)|$. Preferably, find a source for this? ]

\subsection{From \texorpdfstring{$C(\Z_p)$}{C(Z\_p)} to \texorpdfstring{$J(\Z_p)$}{J(Z\_p)}}
By Subsection \ref{subs:smoothzppoints}, we also know that $C(\Z_p)_P$ is in bijection with $\Z_p$, again with the bijection given by evaluating a parameter and dividing by $p$. The resulting function $\Z_p \to \Z_p^g$ is linear and non-constant modulo $p$, i.e. there are power series $f_1,...,f_{g-1} \in \Z_p\angle{z_1,...,z_g}$ such that the image of $C(\Z_p)_P$ is exactly given by $V(f_1,...,f_{g-1})$, and all $f_i$ are linear modulo $p$. Another way to think of this, is as $C(\Z/p^2\Z)_P$ being an affine line inside $J(\Z/p^2\Z)_t$.
TODO: give proof. This uses the functoriality of smooth $\Z_p$-points reducing to a point. That $C(\Z/p^2\Z)_P$ is an affine line inside $J(\Z/p^2\Z)_t$ can also be seen more easily, using Lemma~\ref{lem:smoothpointsfunc}. 
% Say something about the f_i defining C(Z_p) in J(Z_p)

\subsection{Finding \texorpdfstring{$C(\Z)$}{C(Z)}}
Clearly, as subsets of $J(\Z_p)_t$, we have the inclusion $C(\Z)_P \subset C(\Z_p)_P \cap \overline{J(\Z)_t}$. Let $\kappa^*f_1,...,\kappa^*f_{g-1}$ be the pullbacks along $\kappa$ of the $f_i$, and let $I$ be the ideal they generate inside $A := \Z_p\angle{z_1,...,z_r}$. Then $C(\Z_p)_P \cap \overline{J(\Z)_t}$ is in bijection with $\Hom(A/I,\Z_p)$. By Theorem 4.2 of Edixhoven-Lido, we just need to check whether $\overline{A}/\overline{I}$ is finite. As all $\overline{\kappa^* f_i}$ are linear, in fact, $\overline{A}/\overline{I}$ is always of the form $0$ (meaning no solutions) or $\F_p[w_1,...,w_s]$ for some $s \leq r$, and $s = 0$ iff the system of linear equations $\overline{\kappa^* f_i} = 0, i \in \{1,...,g-1\}$ has a unique solution. In general, we may hope an upper bound for $|C(\Z)_P|$ of $1$ if $r \leq g-1$.

% Pull back the f_i along kappa for the final theorem

\subsection{Calculations modulo \texorpdfstring{$p^2$}{p\^2}}
Say something about how, for the right set of points $\{p_1,...,p_g\}$, the map $C^{g} \to J$ is etale at that set of points. Then say something about what that implies about $J(\Z_p)_0$ (equal to $\sum q_i - p_i$ where $q_i \in C(\Z_p)_{p_i}$), and $J(\Z/p^2\Z)_0$, which becomes isomorphic as vector spaces to $\F_p^g$, and how we can find $\kappa$ by expressing elements of $J(\Z)_0$ in that basis, and similarly $f_1,...,f_{g-1}$ by finding $P_1 - P_2$ in that basis for some $Q_1,Q_2 \in C(\Z/p^2\Z)_P$ not equal.

An important part of this, is that there is a parametrisation $P_\mu, \mu \in \F_p$ of the points in $C(\Z/p^2\Z)_P$ such that $P_\mu + P_\nu = P_{\mu + \nu} + P_0$ as Cartier divisors.

\section{Implementations of linear Chabauty and an explicit example}
[TODO: make sure I clearly differentiate divisors and divisor classes]
We now assume that $C$ is hyperelliptic, i.e. given by the degree $2g+2$ homogenisation of an equation of the form
\[
y^2 = f(x)
\]
inside $\P(1,g+1,1)$ where $f$ is a monic polynomial of degree $2g+1$ or $2g+2$. An alternative way of defining such a curve, and the one we will be using mainly, is as a glueing of two affine charts: $y^2 = f(x)$, and $w^2 = f^{r}(v)$, where $f^{r}(v)$ is the polynomial $v^{2g + 2} f(1/v)$, and a birational map between them is given by $(x,y) \mapsto (\frac{1}{x},\frac{y}{x^{-g-1}})$. We also have the coordinates $X,Y,Z$ of $\P(1,g+1,1)$, with $x = X/Z, y = Y/Z^{g+1}, v = Z/X, w = Y/X^{g+1}$, but beware; these coordinates do not behave nicely on the origin of the patch $D(Y)$. We mainly use the first chart; we call any point that lies on it an affine point of $C$. We will treat the case that $f$ has degree $2g+2$ (this can be done by translating $f$ until the constant coefficient is non-zero, and then looking at $f^r$). In that case, near the line at infinity $C$ looks like $Y^2 = X^{2g+2}$, i.e. $(Y-X^{g+1})(Y+X^{g+1}) = 0$, and we see there are two points $\infty_+ = (1:1:0)$ and $\infty_- = (1:-1:0)$. Finally, we note that there is an involution on $C$ given by $\sigma(x,y) = (x,-y)$ and $\sigma(v,w) = (v,-w)$.

\subsection{Makdisis algorithms}
Say something about how Makdisis algorithms work (i.e., give an introduction to the terminology) \cite{makdisi2004}.

As we are using and adding on an implementation by Mascot \cite{mascot2018}, we briefly introduce his notation. This is a summary of section 2.1 in \cite{mascot2018}.

We first look at representing $J(k)$ where $k$ is a field. Given a divisor $D$ on $C$, denote
\[
\Lcal(D) = \{f \in k(C)^\times : \div(f) + D \geq 0 \} \sqcup \{0\}.
\]
We pick $D_0$ an effective divisor of degree $d_0 \geq 2g+1$; in the case of hyperelliptic curves, this will be $(g+1)(\infty_+ + \infty_-)$. We set $V_n = \Lcal(nD_0)$. We let $n_Z$ be an integer $\geq 5d_0 + 1$, and assume, if necessary passing to an extension of $k$, that we have a set $Z$ of size $n_Z$ of distinct points in $C(k)$ outside the support of $D_0$; in fact, this will consist of affine points in our case. We have an evaluation map $V_5 \to k^Z$, evaluating a rational function at $Z$. By our choice of $n_Z$, this is an injective map, i.e. we can represent rational functions in $V_5$ by their values in $k^Z$. In this representation, we can add, subtract, or, if the degree at infinity is not too large, even multiply rational functions, by respectively adding, subtracting or multiplying the correspondig vectors in $k^Z$. It is now also possible to represent subspaces of $V_5$ by giving a basis in $k^Z$. (Instead of passing to an extension of $k$, one could also evaluate functions on infinitesemal neighborhoods of $k$-points, i.e. compute Taylor expansions near those points.)

We now explain the representation of $J(k)$. Note that for any $x \in J(k)$, we have that $x + [D_0]$ is a divisor class of degree at least $2g+1$ and hence is equivalent to an effective divisor $E \geq 0$ of degree $d_0$. Then we represent $x$ by $\Lcal(2D_0 - E)$ inside $V_2$; by Riemann-Roch this is a $d_W$-dimensional subspace of $V_2$ where $d_W = d_0 + 1 - g$, and in particular we can represent it as a $n_z \times d_W$ matrix, itself representing a subspace of $k^Z$. This representation is nowhere near unique; there are many different effective divisors $E$ equivalent to $x + D_0$, and many bases for a subspace of $k^Z$.

As explained in Mascot's article, using this representation one can do all relevant computations in $J(k)$; adding, subtracting, finding the zero element, and most importantly: checking equality.

\subsubsection{Going from \texorpdfstring{$\F_p$}{Fp} to \texorpdfstring{$\Z/p^e\Z$}{Z/peZ}}
We now know how to compute in $J(k)$ for $k$ a field such that $C(k)$ is big enough. In practice, if we want to calculate in $J(\F_p)$, this means passing to $J(\F_q)$ for some $q = p^a$ with $a$ large enough; by the Hasse-Weil bound this will work. However, for Chabauty we want to compute inside $J(\Z/p^e\Z)$. Luckily, Mascots code takes care of this too, by passing from vector spaces over $\F_p$ to free $R$-submodules of $R^n$ with $R = \Z/p^e\Z$; in fact, all submodules of $R^n$ we will be seeing are free. That means all these submodules will have good reduction, i.e. they will remain free and of the same rank after tensoring with $\F_p$. If the maps between such modules also have good reduction, then all kernels, images, et cetera will also have these properties, and can first be calculated modulo $p$ using linear algebra and then by Hensel lifting modulo higher powers of $p$.

The final trick we need is extensions of $\Z/p^e\Z$. As said before, we need $n_Z$ affine points that are distinct modulo $p$, so we passed from $\F_p$ to an extension of $\F_q$. The corresponding notion of an extension of $\Z/p^e\Z$ is given by taking an irreducible polynomial $\overline{T} \in \F_p[t]$ with $\F_q \cong \F_p[t]/\overline{T}$, arbitrarily lifting $\overline{T}$ to a polynomial $T \in \Z/p^e\Z$, and looking at $R = \Z/p^e\Z[t]/T$. Again, we will only be looking at free submodules of $R^n$, so we can again do normal linear algebra over $R \tensor \F_p = \F_q$, and using Hensel to lift.

\subsection{Implementing the Abel-Jacobi map}
Say something about implementing the Abel-Jacobi map $C \to J, Q \mapsto Q - \infty_+$. Right now, information about this (the implementation and why it works) can be found in Hyper2RR.gp.

Now that we can do computations with elements in the Jacobian over $\Z/p^2\Z$, it only remains to construct elements in the Jacobian. Explicitly, we want to go from a degree zero divisor to an element in Mascots representation. Generally these divisors are not always sums of points over the ring we are working with, but if $J(\Z)$ is generated by $C(\Z)$, then we only need this in cases where divisors are sums of points. Since we can add elements in the Jacobian, for this it is enough to compute the Abel-Jacobi embedding
\begin{align*}
j_{\infty_+}: C &\to J \\
              P &\mapsto P-\infty_+.
\end{align*}
If the degree zero divisor is not a sum of points, one can temporarily pass to an extension, knowing that the result at the end will be defined over the ring we started with.
We will only need $j_{\infty_+}(P)$ and $j_{\infty_-}(P)$ for affine points $P$; as the calculation of $j_{\infty_-}(P)$ is entirely similar to $j_{\infty_+}(P)$, we only focus on $j_{\infty_+}(P)$. For this, we present the following algorithm:

\begin{algorithm}[H]
\label{alg:abeljacobi}
 \KwData{$C,J$, an affine point $P \in C(R)$ where $R = \Z/p^e\Z)$}
 \KwResult{A space of the form $\Lcal(2D_0 - E)$ where $E-D_0 = P - \infty_+$ as divisors and $E \geq 0$}
 $Z' \leftarrow Z \sqcup \{P\}$\;
 $B = (b_1,\dots,b_{g+3}) \leftarrow$ a basis of $\Lcal(D_0)$\; \label{alg:abeljacobi:basisLD0}
 \eIf{$(f^r)'(0) \not= 0$}{
   $F \leftarrow x^{g+1} + y$\;\label{alg:abeljacobi:defF1}
   }{
   $F \leftarrow x^{g+1} + x^g +  y$\;\label{alg:abeljacobi:defF2}
  }
 $b_{g+4} \leftarrow xF$\;
 $W \leftarrow$ a $(n_Z + 1)\times (g+4)$ matrix with rows being the evaluations of $B\sqcup{b_{g + 4}}$ on a point in $Z'$.\;
 $V \leftarrow \ker(\im W \subset R^{n_Z + 1} \to R)$, the projection on the last coordinate.\; \label{alg:abeljacobi:kerp}
 %Calculate $\Lcal(D_0 + \infty_+ - P)$\;
 $U \leftarrow \im(V \to R^{n_Z})$, where the last map is the projection on the first coordinates.\;
 Return $U$\;
 \caption{The Abel-Jacobi embedding}
\end{algorithm}

\begin{prop}
\label{prop:abeljacobi}
Algorithm~\ref{alg:abeljacobi} gives correct output.
\end{prop}
Before this proof, we start with a quick lemma.
\begin{lem}
\label{lem:poles2d0i+}
The poles of $F$, as defined in line~\ref{alg:abeljacobi:defF1} or \ref{alg:abeljacobi:defF2}, are exactly $g(\infty_+ + \infty_-) + \infty_+$. 
\end{lem}
\begin{proof}
We start by recalling that at the other affine patch, the curve $C$ is given by $w^2 = f^r(v)$ and by the assumption that $f$ is monic of degree $2g+2$ we have $f^r(0) = 1$. The points $\infty_\pm$ correspond to $(v,w) = (0,\pm 1)$ in this patch. Letting $g^r(v)$ be the polynomial $(f^r(v)-1)/v$, we can rewrite the equation for $C$ to $(w-1)(w+1) = vg^r(v)$. As the derivative of $(w-1)(w+1)$ to $w$ doesn't vanish at both of $\infty_\pm$, we see that $v$ is a uniformiser at both these points. That means that $v_{\infty_\pm}(x)$, the order of $x$ at $\infty_\pm$, is equal to $-1$.

Now, if $g^r(0)$ is non-zero, then $w- \pm 1$ is also a uniformiser at $\infty_\pm$ and non-zero at $\infty_\mp$, so \[(w+1)/v^{g+1} = y + x^{g+1}\] has poles exactly $(g+1)(\infty_+ + \infty_-) - \infty_-$ as we wanted to show.
And if $g^r(0)$ is zero, then $v_{\infty_\pm}(w-\pm1)$ is at least $2$ so $w-\pm 1 + v$ is a uniformiser at $\infty_\pm$ and non-zero at $\infty_\mp$, so \[(w+1+v)/v^{g+1} = y + x^{g+1} + x^{g}\] again has the right poles.
\end{proof}


\begin{proof}[Proof of Proposition \ref{prop:abeljacobia}]
First note that by Riemann-Roch, the dimension of $\Lcal(D_0)$ is $g + 3$, and we also have by the proof of the previous lemma that $1,x,\dots,x^{g+1},y$ all lie in $\Lcal(D_0)$ and hence form a basis, so we can indeed find $B$ as in line~\ref{alg:abeljacobi:basisLD0}. Note that by Lemma~\ref{lem:poles2d0i+} the element $b_{g+4}$ lies in $\Lcal(D_0 + \infty_+)$ but not in $\Lcal(D_0)$, so as adding a point to a divisor causes the the dimension to increase by at most $1$, we have by that $b_1,\dots,b_{g+4}$ is a basis for $\Lcal(D_0 + \infty_+)$; that it is in fact a basis is evident as this argument tells us it is a basis when tensored with $\F_p$.

Evaluating $\Lcal(D_0 + \infty_+)$ on $P$ gives a linear map $\Lcal(D_0 + \infty_+) \to R$, and the kernel is exactly $\Lcal(D_0 + \infty_+ - P)$; this is the resulting $U$ in line~\ref{alg:abeljacobi:kerp}. Furthermore we have the equality of divisors $P-\infty_+ = E - D_0$ where $E = P + D_0 - \infty_+ \geq 0$, so $\Lcal(D_0 + \infty_+ - P)$ is as a subspace of $V_2$ equal to $\Lcal(2D_0 - E)$. This last term is in fact in Mascots representation, so this represents $P-\infty_+$ in the Jacobian.
\end{proof}

Say something about how with just this map and Mascots code, one can already find the $\overline{\kappa^* f_i} $ and compute an upper bound for $C(\Z)_P$ using brute force.

\subsection{Speeding up the calculations}
Say something about how one express an element in $J(\Z/p^2\Z)_0$ on the basis in something like $O(g)$ hopefully (ignoring the time for adding,multiplying, et cetera in the Jacobian), identify $J(Z/p^2)_0$ with $F_p^g$ using $g$ generators of the ideal of the zero section of $J_{Z/p^2}$, then the group structure that $J$ induces on $F_p^g$ is the usual addition. This is currently done using code from Mascot. Say what the final complexity is.

\subsection{An explicit example}
Treat the example in ExChabauty.gp.

\section{The Poincare torsor}
Define and cite theorems about the Poincare Torsor

\section{Quadratic Chabauty using the Poincare torsor}
Explain how to do Chabauty in the case $r < g + \rho - 1$, where $\rho$ is the N\'eron-Severirank.

\section{Implementations of quadratic Chabauty and an explicit example}
Explain something about implementing quadratic Chabauty.

\newpage
\bibliographystyle{alpha}
\addcontentsline{toc}{section}{References}
\bibliography{ref.bib}

\end{document}
